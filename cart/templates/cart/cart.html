{% extends "base.html" %}
{% load static %}
{% load cart_tools %}

{% block page_header %}
<div class="container header-container mb-4">
    <div class="row">
        <div class="col text-center">
            <hr class="w-25 mx-auto">
            <h2 class="logo-font mt-3 text-black">Shopping Cart</h2>
            <hr class="w-25 mx-auto">
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="overlay"></div>

<div class="container mb-5">

    {% if cart_items or subscription_item %}

        <div class="table-responsive">

            <!-- SINGLE, VALID TABLE -->
            <table class="table table-sm cart-table align-middle">

                <thead class="table-info">
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th class="text-center">Qty</th>
                        <th class="text-right">Subtotal</th>
                    </tr>
                </thead>

                <tbody>
                    {% for item in cart_items %}
                        <tr class="d-block d-md-table-row border rounded mb-3 mb-md-0 p-2 p-md-0">

                            <!-- PRODUCT -->
                            <td class="d-flex d-md-table-cell align-items-center">
                                <span class="d-md-none font-weight-bold mr-2">Product:</span>
                                {% include "cart/product_image.html" %}
                            </td>

                            <!-- PRICE -->
                            <td class="d-flex d-md-table-cell justify-content-between">
                                <span class="d-md-none font-weight-bold">Price:</span>
                                £{{ item.product.price|floatformat:2 }}
                            </td>

                            <!-- QUANTITY -->
                            <td class="d-flex d-md-table-cell justify-content-between text-md-center">
                                <span class="d-md-none font-weight-bold">Qty:</span>
                                {% include "cart/quantity_form.html" %}
                            </td>

                            <!-- SUBTOTAL -->
                            <td class="d-flex d-md-table-cell justify-content-between text-md-right pr-md-5">
                                <span class="d-md-none font-weight-bold">Subtotal:</span>
                                <strong>£{{ item.line_total|floatformat:2 }}</strong>
                            </td>

                        </tr>
                    {% endfor %}

                    {% if subscription_item %}
                        <tr class="d-block d-md-table-row table-info border rounded p-2">
                            {% include "cart/subscription_row.html" %}
                        </tr>
                    {% endif %}
                </tbody>

                <tfoot>
                    <tr>
                        <td colspan="4" class="text-center text-md-right pt-4">
                            {% include "cart/cart_totals.html" %}
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4" class="text-center text-md-right">
                            {% include "cart/checkout_buttons.html" %}
                        </td>
                    </tr>
                </tfoot>

            </table>
        </div>

    {% else %}

        <div class="text-center py-5">
            <i class="fas fa-shopping-cart fa-4x text-muted"></i>
            <p class="lead mt-3">Your cart is empty.</p>
            <a href="{% url 'products' %}" class="btn btn-outline-dark mt-2">
                <i class="fas fa-chevron-left mr-1"></i> Visit Shop
            </a>
        </div>

    {% endif %}

</div>
{% endblock %}

{% block postloadjs %}
    {{ block.super }}
    {% include "products/includes/quantity_input_script.html" %}
    {% include "cart/cart_scripts.html" %}
{% endblock %}
